<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming News Aggregator</title>
    <!-- Roboto font + Material Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

    <!-- React & MUI via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script crossorigin src="https://unpkg.com/@emotion/react@11/umd/emotion-react.umd.min.js"></script>
    <script crossorigin src="https://unpkg.com/@emotion/styled@11/umd/emotion-styled.umd.min.js"></script>
    <script crossorigin src="https://unpkg.com/@mui/material@5/umd/material-ui.development.js"></script>
    <!-- Babel for in-browser JSX transform (development only) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body style="margin:0">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;
      const {
        AppBar,
        Toolbar,
        Typography,
        Tabs,
        Tab,
        Container,
        Card,
        CardContent,
        CardActions,
        Button,
        Box,
        CircularProgress,
      } = MaterialUI;

      function NewsList() {
        const [data, setData] = useState(null);
        useEffect(() => {
          fetch('/api/news')
            .then(r => r.json())
            .then(setData)
            .catch(() => setData([]));
        }, []);
        if (!data) return <Box textAlign="center" my={4}><CircularProgress /></Box>;
        return (
          <Box my={2}>
            {data.map((item, idx) => (
              <Card key={idx} sx={{ mb: 2 }}>
                <CardContent>
                  <Typography variant="h6" component="div">{item.title}</Typography>
                  <Typography variant="body2" color="text.secondary" gutterBottom>
                    {item.published}
                  </Typography>
                  <div dangerouslySetInnerHTML={{ __html: item.summary }}></div>
                </CardContent>
                <CardActions>
                  <Button size="small" href={item.link} target="_blank">Читать</Button>
                </CardActions>
              </Card>
            ))}
          </Box>
        );
      }

      function Deals() {
        const [data, setData] = useState(null);
        useEffect(() => {
          fetch('/api/deals')
            .then(r => r.json())
            .then(setData)
            .catch(() => setData({ deals: [], freebies: [] }));
        }, []);
        if (!data) return <Box textAlign="center" my={4}><CircularProgress /></Box>;
        return (
          <Box my={2}>
            <Typography variant="h5" gutterBottom>Скидки</Typography>
            {data.deals.map(d => (
              <Card key={d.dealID} sx={{ mb: 2 }}>
                <CardContent>
                  <Typography variant="h6">{d.title}</Typography>
                  <Typography variant="body2" color="text.secondary">
                    Цена: ${d.salePrice} (обычно ${d.normalPrice}) — Экономия {parseFloat(d.savings).toFixed(1)}%
                  </Typography>
                </CardContent>
                <CardActions>
                  <Button size="small" href={`https://www.cheapshark.com/redirect?dealID=${d.dealID}`} target="_blank">Перейти</Button>
                </CardActions>
              </Card>
            ))}

            <Typography variant="h5" gutterBottom mt={4}>Бесплатные раздачи</Typography>
            {data.freebies.map(f => (
              <Card key={f.dealID} sx={{ mb: 2, backgroundColor: '#EADDFF' }}>
                <CardContent>
                  <Typography variant="h6">{f.title}</Typography>
                  <Typography variant="body2" color="text.secondary">
                    Сейчас бесплатно (обычно ${f.normalPrice})
                  </Typography>
                </CardContent>
                <CardActions>
                  <Button size="small" href={`https://www.cheapshark.com/redirect?dealID=${f.dealID}`} target="_blank">Получить</Button>
                </CardActions>
              </Card>
            ))}
          </Box>
        );
      }

      function App() {
        const [tab, setTab] = useState(0);
        return (
          <Box>
            <AppBar position="static" color="primary">
              <Toolbar>
                <Typography variant="h6" sx={{ flexGrow: 1 }}>Gaming News Aggregator</Typography>
                <Tabs value={tab} onChange={(e, v) => setTab(v)} textColor="inherit" indicatorColor="secondary">
                  <Tab label="Новости" />
                  <Tab label="Скидки" />
                </Tabs>
              </Toolbar>
            </AppBar>
            <Container maxWidth="md">
              {tab === 0 && <NewsList />}
              {tab === 1 && <Deals />}
            </Container>
          </Box>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html> 